<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UTI Phage Finder (Demo)</title>
  <style>
    body{font-family:Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; padding:32px;}
    h1{margin:0 0 8px; color:#38bdf8;}
    .badge{display:inline-block; background:#22c55e; color:#052e16; padding:6px 10px; border-radius:8px; font-weight:bold; margin-bottom:20px;}
    .card{background:#020617; border:1px solid #1f2937; border-radius:12px; padding:18px; max-width:780px; margin-bottom:16px;}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center;}
    label{font-size:14px; color:#cbd5e1;}
    input[type="file"]{background:#0b1224; color:#e5e7eb; border:1px solid #334155; padding:10px; border-radius:10px; width:100%; max-width:420px;}
    button{background:#38bdf8; color:#020617; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700;}
    button:hover{background:#0ea5e9;}
    button:disabled{opacity:.5; cursor:not-allowed;}
    .muted{color:#94a3b8; font-size:13px;}
    pre{background:#0b1224; border:1px solid #334155; border-radius:12px; padding:14px; overflow:auto; white-space:pre-wrap; margin:0;}
  </style>
</head>

<body>
  <h1>UTI Phage Finder</h1>
  <div class="badge">DEMO MODE (Mock Tools)</div>

  <div class="card">
    <div class="row">
      <div style="flex:1;">
        <label>Upload FASTA file (any .fna/.fa/.fasta)</label><br />
        <input type="file" id="demoFile" />
        <div class="muted" style="margin-top:6px;">
          This UI calls mock endpoints: /api/casfinder, /api/lifestyle, /api/amr_screen
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="row">
      <button id="btnCas" onclick="demoRun('/api/casfinder')">Run CasFinder</button>
      <button id="btnLife" onclick="demoRun('/api/lifestyle')">Predict Lifestyle</button>
      <button id="btnAmr" onclick="demoRun('/api/amr_screen')">AMR Screening</button>
    </div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between;">
      <div>
        <strong>Results</strong>
        <div class="muted">JSON output from the backend will appear here.</div>
      </div>
      <div class="muted" id="status"></div>
    </div>
    <div style="margin-top:12px;">
      <pre id="out">No results yet.</pre>
    </div>
  </div>

  <script>
    // Same-domain API base (Render)
    const API_BASE = "";

    function setBusy(isBusy) {
      document.getElementById("btnCas").disabled = isBusy;
      document.getElementById("btnLife").disabled = isBusy;
      document.getElementById("btnAmr").disabled = isBusy;
    }

    async function demoRun(endpoint) {
      const fileInput = document.getElementById("demoFile");
      const out = document.getElementById("out");
      const status = document.getElementById("status");

      if (!fileInput.files.length) {
        out.textContent = "Upload a file first.";
        return;
      }

      const f = fileInput.files[0];
      const fd = new FormData();
      fd.append("file", f);

      setBusy(true);
      status.textContent = "Running " + endpoint + " ...";
      out.textContent = "";

      try {
        const res = await fetch(API_BASE + endpoint, { method: "POST", body: fd });
        const data = await res.json();

        if (!res.ok) {
          // backend returns {"detail": "..."} on error
          out.textContent = JSON.stringify(data, null, 2);
          status.textContent = "Error (" + res.status + ")";
          setBusy(false);
          return;
        }

        out.textContent = JSON.stringify(data, null, 2);
        status.textContent = "Done (" + res.status + ")";
      } catch (e) {
        out.textContent = "Network error: " + e;
        status.textContent = "Error";
      } finally {
        setBusy(false);
      }
    }
  </script>
</body>
</html>
